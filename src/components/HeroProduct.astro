---
import Badge from './Badge.astro';
import DevicePlaceholder from './DevicePlaceholder.astro';

interface Props {
  name: string;
  headline: string;
  role: string;
  status: 'online' | 'offline' | 'maintenance' | 'retired';
  type: string;
  location?: string;
  services?: string[];
  stack?: string[];
  photo?: string;
  slug: string;
  eyebrowOverride?: string;
  tagline?: string;
}

const {
  name,
  headline,
  role,
  status,
  type,
  location,
  services = [],
  photo,
  slug,
  eyebrowOverride,
  tagline,
} = Astro.props;

const typeLabel: Record<string, string> = {
  'raspberry-pi': 'Raspberry Pi',
  'server':       'Server',
  'nas':          'NAS',
  'network':      'Network',
  'pc':           'PC',
  'display':      'Display',
  'console':      'Console',
  'smart-home':   'Smart Home',
  'other':        'Device',
};

const typeStr = typeLabel[type] ?? type;
const eyebrow = [typeStr, location].filter(Boolean).join(' · ');

const heroTint: Record<string, string> = {
  'raspberry-pi': 'rgba(79,142,247,0.08)',
  'nas':          'rgba(245,158,11,0.07)',
  'server':       'rgba(99,102,241,0.08)',
  'pc':           'rgba(99,102,241,0.07)',
  'network':      'rgba(34,197,94,0.07)',
  'console':      'rgba(236,72,153,0.07)',
  'smart-home':   'rgba(168,85,247,0.08)',
  'display':      'rgba(148,163,184,0.06)',
};
const tint = heroTint[type] ?? 'rgba(79,142,247,0.05)';
---

<section
  class="relative pt-28 pb-0 overflow-hidden"
  aria-label="Device hero"
>
  <!-- Ambient background — very subtle, no glow spam -->
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    <div class="absolute inset-0 bg-[var(--color-surface-0)]"></div>
    <div
      class="absolute top-0 left-1/2 -translate-x-1/2"
      style={`width:clamp(280px,80vw,600px); height:clamp(150px,40vw,300px); background: radial-gradient(ellipse at center, ${tint} 0%, transparent 70%);`}
    ></div>
  </div>

  <div class="container-content relative z-10">

    <!-- Top metadata row -->
    <div class="flex items-center gap-3 mb-8 reveal-fast">
      <p class="text-[0.75rem] font-medium tracking-[0.1em] uppercase text-[var(--color-ink-3)]">
        {eyebrowOverride ?? eyebrow}
      </p>
      <span class="text-[var(--color-ink-4)]" aria-hidden="true">/</span>
      <Badge status={status} size="sm" />
    </div>

    <!-- Two-column layout: text left, media right (desktop) -->
    <div class="grid grid-cols-1 lg:grid-cols-[1fr_440px] gap-10 lg:gap-24 items-center pb-16 lg:pb-20">

      <!-- Left: Identity -->
      <div>
        <h1
          class="text-[clamp(2.75rem,6vw,5.5rem)] font-bold leading-[1.02] tracking-[-0.03em] text-[var(--color-ink-1)] mb-5 reveal"
          style={`view-transition-name: device-name-${slug}`}
        >
          {name}
        </h1>

        <p
          class="text-[clamp(1.2rem,2.5vw,1.65rem)] font-light leading-[1.3] tracking-[-0.01em] text-[var(--color-ink-2)] mb-4 reveal"
          style="transition-delay: 80ms"
        >
          {role}
        </p>

        {tagline && (
          <p
            class="text-[clamp(0.9rem,1.5vw,1.05rem)] font-normal italic leading-[1.5] text-[var(--color-ink-3)] mb-5 reveal"
            style="transition-delay: 110ms"
          >
            {tagline}
          </p>
        )}

        <p
          class="text-[1rem] leading-[1.65] text-[var(--color-ink-3)] max-w-[42ch] mb-10 reveal"
          style="transition-delay: 150ms"
        >
          {headline}
        </p>

        <!-- Quick service count stat -->
        {services.length > 0 && (
          <div class="flex items-baseline gap-3 mb-10 reveal" style="transition-delay: 180ms">
            <span class="text-[2rem] font-semibold tabular-nums text-[var(--color-ink-1)]">
              {services.length}
            </span>
            <span class="text-[0.875rem] text-[var(--color-ink-3)]">
              Dienste aktiv
            </span>
          </div>
        )}

        <!-- CTAs -->
        <div class="flex flex-wrap gap-3 reveal" style="transition-delay: 220ms">
          <a href="#outcomes" class="btn-secondary">
            Was ich gebaut habe
          </a>
          <a href="#specs" class="btn-secondary">
            Technische Daten
          </a>
          {services.length > 0 && (
            <a href="#services" class="btn-secondary">
              Dienste
            </a>
          )}
        </div>
      </div>

      <!-- Right: Media -->
      <div
        class="reveal w-full"
        style={`transition-delay: 100ms; view-transition-name: device-media-${slug}`}
        data-parallax
      >
        <div class="w-full aspect-[4/3] rounded-[20px] overflow-hidden">
          {photo ? (
            <img
              src={photo}
              alt={`${name}`}
              class="w-full h-full object-cover"
              loading="eager"
              decoding="async"
            />
          ) : (
            <div
              class="media-placeholder w-full h-full flex items-center justify-center"
              style={`background: radial-gradient(ellipse 65% 55% at 50% 40%, ${tint} 0%, transparent 70%), linear-gradient(160deg, var(--color-surface-2) 0%, var(--color-surface-3) 100%);`}
            >
              <DevicePlaceholder type={type} size={80} />
            </div>
          )}
        </div>
      </div>

    </div>
  </div>

  <!-- Thin bottom separator -->
  <div class="sep"></div>
</section>
