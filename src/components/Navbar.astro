---
const links = [
  { href: '/',       label: 'Home'   },
  { href: '/lab',    label: 'Lab'    },
  { href: '/builds', label: 'Builds' },
  { href: '/about',  label: 'About'  },
];

const pathname = Astro.url.pathname;
---

<header
  id="navbar"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  role="banner"
>
  <div class="glass border-b border-[rgba(255,255,255,0.06)]">
    <div class="container-wide">
      <nav
        class="flex items-center justify-between h-14"
        aria-label="Main navigation"
      >
        <!-- Logo -->
        <a
          href="/"
          class="flex items-center gap-2.5 group flex-shrink-0"
          aria-label="Homelab Hardware — Home"
        >
          <div class="w-7 h-7 rounded-lg bg-accent flex items-center justify-center transition-transform duration-spring group-hover:scale-110 group-active:scale-95">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
              <rect x="1" y="1" width="5" height="5" rx="1" fill="white"/>
              <rect x="8" y="1" width="5" height="5" rx="1" fill="white" opacity="0.6"/>
              <rect x="1" y="8" width="5" height="5" rx="1" fill="white" opacity="0.6"/>
              <rect x="8" y="8" width="5" height="5" rx="1" fill="white"/>
            </svg>
          </div>
          <span class="font-semibold text-sm tracking-tight text-ink-1 hidden sm:block">
            Homelab
          </span>
        </a>

        <!-- Desktop links -->
        <ul class="hidden sm:flex items-center gap-1" role="list">
          {links.map(({ href, label }) => {
            const isActive = href === '/'
              ? pathname === '/'
              : pathname.startsWith(href);
            return (
              <li>
                <a
                  href={href}
                  class:list={[
                    'relative px-3.5 py-1.5 rounded-full text-[0.8125rem] font-medium transition-colors duration-200 active:scale-95 active:opacity-75',
                    isActive
                      ? 'text-ink-1 bg-[rgba(255,255,255,0.08)]'
                      : 'text-ink-3 hover:text-ink-1 hover:bg-[rgba(255,255,255,0.05)]'
                  ]}
                  aria-current={isActive ? 'page' : undefined}
                >
                  {label}
                </a>
              </li>
            );
          })}
        </ul>

        <!-- Mobile: hamburger button -->
        <button
          id="mobile-menu-btn"
          class="sm:hidden flex items-center justify-center w-9 h-9 rounded-[10px] text-[var(--color-ink-2)] hover:text-[var(--color-ink-1)] hover:bg-[rgba(255,255,255,0.06)] transition-colors duration-200 active:scale-90 active:bg-[rgba(255,255,255,0.10)]"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-label="Toggle navigation"
        >
          <!-- Hamburger icon — animated via CSS -->
          <svg id="icon-menu" width="18" height="18" viewBox="0 0 18 18" fill="none" aria-hidden="true">
            <line x1="3" y1="5"  x2="15" y2="5"  stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <line x1="3" y1="9"  x2="15" y2="9"  stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <line x1="3" y1="13" x2="15" y2="13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <svg id="icon-close" width="18" height="18" viewBox="0 0 18 18" fill="none" aria-hidden="true" class="hidden">
            <line x1="4" y1="4"  x2="14" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <line x1="14" y1="4" x2="4"  y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>

        <!-- Desktop right spacer (keeps links centered) -->
        <div class="hidden sm:block w-16"></div>
      </nav>
    </div>
  </div>

  <!-- Mobile menu dropdown -->
  <div
    id="mobile-menu"
    class="sm:hidden glass border-b border-[rgba(255,255,255,0.06)] overflow-hidden"
    style="max-height: 0; transition: max-height 350ms cubic-bezier(0.16,1,0.3,1), opacity 300ms ease; opacity: 0;"
    aria-hidden="true"
  >
    <nav class="container-wide py-3 flex flex-col gap-1" aria-label="Mobile navigation">
      {links.map(({ href, label }) => {
        const isActive = href === '/'
          ? pathname === '/'
          : pathname.startsWith(href);
        return (
          <a
            href={href}
            class:list={[
              'mobile-nav-link px-4 py-2.5 rounded-[10px] text-[0.9375rem] font-medium transition-all duration-200 active:scale-[0.98]',
              isActive
                ? 'text-[var(--color-ink-1)] bg-[rgba(255,255,255,0.07)]'
                : 'text-[var(--color-ink-3)]',
            ]}
            aria-current={isActive ? 'page' : undefined}
          >
            {label}
          </a>
        );
      })}
    </nav>
  </div>
</header>

<!-- Skip to main content -->
<a
  href="#main-content"
  class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[100] btn-primary"
>
  Skip to main content
</a>

<script>
  // ── Hamburger toggle ────────────────────────────────────────────
  const btn    = document.getElementById('mobile-menu-btn');
  const menu   = document.getElementById('mobile-menu');
  const iconM  = document.getElementById('icon-menu');
  const iconX  = document.getElementById('icon-close');

  function openMenu() {
    menu!.style.maxHeight = '400px';
    menu!.style.opacity   = '1';
    menu!.setAttribute('aria-hidden', 'false');
    btn!.setAttribute('aria-expanded', 'true');
    iconM!.classList.add('hidden');
    iconX!.classList.remove('hidden');
  }
  function closeMenu() {
    menu!.style.maxHeight = '0';
    menu!.style.opacity   = '0';
    menu!.setAttribute('aria-hidden', 'true');
    btn!.setAttribute('aria-expanded', 'false');
    iconM!.classList.remove('hidden');
    iconX!.classList.add('hidden');
  }

  btn?.addEventListener('click', () => {
    const isOpen = btn.getAttribute('aria-expanded') === 'true';
    isOpen ? closeMenu() : openMenu();
  });

  // Close on link click
  menu?.querySelectorAll('.mobile-nav-link').forEach(link => {
    link.addEventListener('click', closeMenu);
  });

  // Close on outside click
  document.addEventListener('click', e => {
    if (!btn?.contains(e.target as Node) && !menu?.contains(e.target as Node)) {
      closeMenu();
    }
  });

  // ── Scroll-aware navbar ─────────────────────────────────────────
  const navbar = document.getElementById('navbar');
  if (navbar) {
    window.addEventListener('scroll', () => {
      navbar.style.setProperty('--nb-opacity', String(Math.min(window.scrollY / 80, 1)));
    }, { passive: true });
  }
</script>
