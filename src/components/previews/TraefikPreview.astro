---
// Traefik reverse proxy routing — animated request flow + route table
const routes = [
  { domain: 'paperless.home',  target: 'paperless-ngx:8000', delay: '0.1s' },
  { domain: 'n8n.home',        target: 'n8n:5678',           delay: '0.3s' },
  { domain: 'vikunja.home',    target: 'vikunja:3456',       delay: '0.5s' },
  { domain: 'portainer.home',  target: 'portainer:9000',     delay: '0.7s' },
];
---

<div class="tr" aria-hidden="true">

  <!-- Chrome -->
  <div class="tr-chrome">
    <div class="tr-traffic">
      <span class="tr-dot tr-dot-r"></span>
      <span class="tr-dot tr-dot-y"></span>
      <span class="tr-dot tr-dot-g"></span>
    </div>
    <span class="tr-title">Traefik Dashboard</span>
    <span class="tr-version">v3.0</span>
  </div>

  <!-- Stats row -->
  <div class="tr-stats">
    <div class="tr-stat">
      <span class="tr-stat-n" id="tr-req">847</span>
      <span class="tr-stat-l">req/min</span>
    </div>
    <div class="tr-stat tr-stat--green">
      <span class="tr-stat-n">4</span>
      <span class="tr-stat-l">routes</span>
    </div>
    <div class="tr-stat">
      <span class="tr-stat-n">0</span>
      <span class="tr-stat-l">errors</span>
    </div>
  </div>

  <!-- Route table -->
  <div class="tr-routes">
    <div class="tr-routes-head">
      <span>DOMAIN</span>
      <span>→</span>
      <span>TARGET</span>
      <span>TLS</span>
    </div>
    {routes.map(r => (
      <div class="tr-route-row" style={`animation-delay: ${r.delay}`}>
        <span class="tr-domain">{r.domain}</span>
        <span class="tr-arrow">→</span>
        <span class="tr-target">{r.target}</span>
        <span class="tr-tls">✓ HTTPS</span>
      </div>
    ))}
  </div>

  <!-- Animated request flow SVG -->
  <div class="tr-flow">
    <svg viewBox="0 0 320 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Nodes -->
      <rect x="0" y="16" width="64" height="16" rx="4"
        fill="rgba(59,130,246,0.12)" stroke="rgba(59,130,246,0.3)" stroke-width="1"/>
      <text x="32" y="26" text-anchor="middle" fill="rgba(147,197,253,0.8)"
        font-size="7" font-family="monospace" dy="3">Internet</text>

      <rect x="128" y="16" width="64" height="16" rx="4"
        fill="rgba(168,85,247,0.12)" stroke="rgba(168,85,247,0.3)" stroke-width="1"/>
      <text x="160" y="26" text-anchor="middle" fill="rgba(196,181,253,0.8)"
        font-size="7" font-family="monospace" dy="3">Traefik</text>

      <rect x="256" y="16" width="64" height="16" rx="4"
        fill="rgba(34,197,94,0.12)" stroke="rgba(34,197,94,0.3)" stroke-width="1"/>
      <text x="288" y="26" text-anchor="middle" fill="rgba(74,222,128,0.8)"
        font-size="7" font-family="monospace" dy="3">Container</text>

      <!-- Arrows -->
      <line x1="64" y1="24" x2="128" y2="24"
        stroke="rgba(59,130,246,0.5)" stroke-width="1.5"
        stroke-dasharray="4 3"
        class="tr-line-anim" style="animation-delay: 0s"/>
      <line x1="192" y1="24" x2="256" y2="24"
        stroke="rgba(168,85,247,0.5)" stroke-width="1.5"
        stroke-dasharray="4 3"
        class="tr-line-anim" style="animation-delay: 0.3s"/>

      <!-- Arrowheads -->
      <polygon points="126,21 132,24 126,27" fill="rgba(59,130,246,0.6)"/>
      <polygon points="254,21 260,24 254,27" fill="rgba(168,85,247,0.6)"/>

      <!-- Labels -->
      <text x="96" y="12" text-anchor="middle" fill="rgba(255,255,255,0.2)"
        font-size="7" font-family="monospace">:443</text>
      <text x="224" y="12" text-anchor="middle" fill="rgba(255,255,255,0.2)"
        font-size="7" font-family="monospace">route</text>
    </svg>
  </div>

</div>

<style>
  .tr {
    background: #0d0d10;
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 14px;
    overflow: hidden;
    font-family: -apple-system, system-ui, sans-serif;
    font-size: 12px;
    width: 100%;
    user-select: none;
  }

  .tr-chrome {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: rgba(255,255,255,0.03);
    border-bottom: 1px solid rgba(255,255,255,0.055);
  }
  .tr-traffic { display: flex; gap: 5px; }
  .tr-dot { width: 9px; height: 9px; border-radius: 50%; }
  .tr-dot-r { background: #ff5f57; }
  .tr-dot-y { background: #febc2e; }
  .tr-dot-g { background: #28c840; }
  .tr-title {
    flex: 1;
    color: rgba(255,255,255,0.5);
    font-size: 11px;
    font-weight: 500;
    text-align: center;
  }
  .tr-version {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(168,85,247,0.15);
    color: rgba(196,181,253,0.8);
    font-variant-numeric: tabular-nums;
  }

  .tr-stats {
    display: flex;
    border-bottom: 1px solid rgba(255,255,255,0.055);
  }
  .tr-stat {
    flex: 1;
    padding: 10px 12px;
    text-align: center;
    border-right: 1px solid rgba(255,255,255,0.04);
  }
  .tr-stat:last-child { border-right: none; }
  .tr-stat-n {
    display: block;
    font-size: 1.3rem;
    font-weight: 700;
    color: rgba(255,255,255,0.8);
    font-variant-numeric: tabular-nums;
    line-height: 1.2;
    animation: tr-count-in 2s cubic-bezier(0.16,1,0.3,1) both;
  }
  @keyframes tr-count-in {
    from { opacity: 0; transform: translateY(4px); }
    to   { opacity: 1; transform: none; }
  }
  .tr-stat--green .tr-stat-n { color: #22c55e; }
  .tr-stat-l {
    display: block;
    font-size: 10px;
    color: rgba(255,255,255,0.25);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 2px;
  }

  /* Route table */
  .tr-routes { padding: 6px 14px; }
  .tr-routes-head {
    display: grid;
    grid-template-columns: 1fr 16px 1fr 56px;
    gap: 6px;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    margin-bottom: 4px;
  }
  .tr-routes-head span {
    font-size: 9px;
    color: rgba(255,255,255,0.2);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .tr-route-row {
    display: grid;
    grid-template-columns: 1fr 16px 1fr 56px;
    gap: 6px;
    padding: 5px 0;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    animation: tr-row-in 0.35s cubic-bezier(0.16,1,0.3,1) both;
  }
  @keyframes tr-row-in {
    from { opacity: 0; transform: translateX(-5px); }
    to   { opacity: 1; transform: none; }
  }
  .tr-domain {
    color: rgba(147,197,253,0.7);
    font-size: 11px;
    font-family: 'SF Mono', monospace;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  .tr-arrow { color: rgba(255,255,255,0.2); font-size: 11px; text-align: center; }
  .tr-target {
    color: rgba(255,255,255,0.4);
    font-size: 10px;
    font-family: 'SF Mono', monospace;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  .tr-tls {
    font-size: 9px;
    color: #22c55e;
    font-weight: 600;
    letter-spacing: 0.02em;
  }

  /* Flow diagram */
  .tr-flow {
    padding: 8px 14px 12px;
    border-top: 1px solid rgba(255,255,255,0.055);
  }
  .tr-flow svg { width: 100%; height: auto; }

  .tr-line-anim {
    stroke-dashoffset: 0;
    animation: tr-dash-flow 1.2s linear infinite;
  }
  @keyframes tr-dash-flow {
    to { stroke-dashoffset: -14; }
  }
</style>
