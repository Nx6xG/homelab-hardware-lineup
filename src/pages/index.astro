---
import { getCollection } from 'astro:content';
import Layout from '../components/Layout.astro';
import Reveal from '../components/Reveal.astro';
import DevicePlaceholder from '../components/DevicePlaceholder.astro';

const devices  = await getCollection('devices');
const software = await getCollection('software');
const sorted   = [...devices].sort(
  (a, b) => new Date(b.data.updated).getTime() - new Date(a.data.updated).getTime()
);

const lineup = sorted.slice(0, 6);

// Per type: panel gradient + centered bloom + icon tint
const getAccent = (type: string) => {
  const map: Record<string, { bg: string; bloom: string; icon: string }> = {
    'raspberry-pi': { bg: 'rgba(79,142,247,0.09)',  bloom: 'rgba(79,142,247,0.18)',  icon: 'rgba(79,142,247,0.32)'  },
    'nas':          { bg: 'rgba(245,158,11,0.08)',  bloom: 'rgba(245,158,11,0.15)',  icon: 'rgba(245,158,11,0.30)'  },
    'server':       { bg: 'rgba(99,102,241,0.09)',  bloom: 'rgba(99,102,241,0.16)',  icon: 'rgba(99,102,241,0.32)'  },
    'pc':           { bg: 'rgba(99,102,241,0.08)',  bloom: 'rgba(99,102,241,0.14)',  icon: 'rgba(99,102,241,0.30)'  },
    'network':      { bg: 'rgba(34,197,94,0.07)',   bloom: 'rgba(34,197,94,0.13)',   icon: 'rgba(34,197,94,0.28)'   },
    'console':      { bg: 'rgba(236,72,153,0.07)',  bloom: 'rgba(236,72,153,0.13)',  icon: 'rgba(236,72,153,0.28)'  },
    'smart-home':   { bg: 'rgba(168,85,247,0.07)',  bloom: 'rgba(168,85,247,0.13)',  icon: 'rgba(168,85,247,0.28)'  },
    'display':      { bg: 'rgba(148,163,184,0.06)', bloom: 'rgba(148,163,184,0.10)', icon: 'rgba(148,163,184,0.24)' },
  };
  return map[type] ?? { bg: 'rgba(79,142,247,0.07)', bloom: 'rgba(79,142,247,0.13)', icon: 'rgba(79,142,247,0.28)' };
};

const statusLabels: Record<string, string> = {
  online:      'Online',
  offline:     'Offline',
  maintenance: 'Wartung',
  retired:     'Ausgemustert',
};

const heroLines = ['HomeLab.'];

const sysMetrics = [
  { value: String(devices.length),  label: 'Geräte'          },
  { value: String(software.length), label: 'Dienste'          },
  { value: '100%',                  label: 'Selbst gehostet'  },
  { value: '0€',                    label: 'Cloud-Kosten'     },
];

const docItems = [
  'Was darauf läuft',
  'Architekturüberblick',
  'Getroffene Entscheidungen',
  'Kompromisse & Erkenntnisse',
  'Was ich als Nächstes verbessern würde',
  'Vollständige Spezifikationen',
];
---

<Layout
  title="HomeLab"
  description="Hardware, Software und Architektur — ein persönliches Homelab, dokumentiert wie ein Produkt."
>

  <!-- ═══════════════════════════════════════════════════════
       HERO
  ════════════════════════════════════════════════════════════ -->
  <section
    class="hero-ambient bg-grid relative min-h-screen flex flex-col items-center justify-center pt-24 pb-28 lg:pb-40 overflow-hidden"
    aria-label="Introduction"
  >
    <div
      aria-hidden="true"
      style="position:absolute; pointer-events:none; top:30%; left:50%; transform:translate(-50%,-50%); width:clamp(500px,110vw,1100px); height:clamp(400px,80vw,800px); background:radial-gradient(ellipse at center, rgba(79,142,247,0.10) 0%, rgba(99,102,241,0.04) 45%, transparent 68%); filter:blur(110px);"
    ></div>
    <div
      aria-hidden="true"
      class="drift"
      style="position:absolute; pointer-events:none; bottom:20%; right:15%; width:clamp(140px,25vw,300px); height:clamp(100px,18vw,220px); background:radial-gradient(ellipse at center, rgba(99,102,241,0.07) 0%, transparent 65%); filter:blur(55px); animation-delay:-6s; opacity:0.4;"
    ></div>

    <div class="container-content relative z-10 text-center">
      <p
        class="text-[0.68rem] font-semibold tracking-[0.26em] uppercase text-[var(--color-ink-4)] mb-10 sm:mb-12"
        style="animation:hero-fade-up 600ms 80ms cubic-bezier(0.16,1,0.3,1) both"
      >
        Persönliches Homelab
      </p>

      <h1 class="mb-8 sm:mb-12" aria-label="HomeLab.">
        {heroLines.map((line, i) => (
          <div
            class="word-in block font-extrabold tracking-[-0.045em] text-[var(--color-ink-1)]"
            style={`font-size:clamp(3.4rem,14vw,11rem); line-height:0.90; animation-delay:${160 + i * 160}ms`}
          >
            {line}
          </div>
        ))}
      </h1>

      <p
        class="text-[clamp(1rem,1.8vw,1.2rem)] font-light text-[var(--color-ink-3)] max-w-[38ch] mx-auto leading-[1.65] mb-10 sm:mb-14"
        style="animation:hero-fade-up 700ms 570ms cubic-bezier(0.16,1,0.3,1) both"
      >
        Hardware, Software und Architektur —
        dokumentiert wie ein Produkt.
      </p>

      <div
        class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4"
        style="animation:hero-fade-up 700ms 700ms cubic-bezier(0.16,1,0.3,1) both"
      >
        <a href="/lab" class="btn-primary-lg w-full sm:w-auto justify-center">
          Das Lab erkunden
          <svg width="15" height="15" viewBox="0 0 14 14" fill="none" aria-hidden="true">
            <path d="M2 7h10M7 2l5 5-5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <a href="/lineup" class="btn-secondary-lg w-full sm:w-auto justify-center">
          Hardware ansehen
        </a>
      </div>
    </div>

    <div
      aria-hidden="true"
      class="absolute inset-x-0 bottom-0 h-64 pointer-events-none"
      style="background:linear-gradient(to top, var(--color-surface-0) 0%, rgba(5,7,15,0.85) 40%, transparent 100%);"
    ></div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       SYSTEM OVERVIEW
  ════════════════════════════════════════════════════════════ -->
  <section class="py-20 lg:py-32 section-divider" aria-labelledby="overview-h">
    <div class="container-content">

      <Reveal class="mb-14 sm:mb-16">
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
          Überblick
        </p>
        <h2 id="overview-h" class="text-display-sm text-[var(--color-ink-1)]">
          Das System, auf einen Blick.
        </h2>
      </Reveal>

      <Reveal delay={80}>
        <div
          class="glass-card-glow rounded-[20px] px-5 sm:px-8 py-7 sm:py-10"
          role="list"
          aria-label="Systemkennzahlen"
        >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-6 sm:gap-8">
            {sysMetrics.map(({ value, label }) => (
              <div class="text-center" role="listitem">
                <p class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold text-[var(--color-ink-1)] tabular-nums leading-none mb-1.5">
                  {value}
                </p>
                <p class="text-[0.65rem] font-medium tracking-[0.1em] uppercase text-[var(--color-ink-4)]">
                  {label}
                </p>
              </div>
            ))}
          </div>
        </div>
      </Reveal>

    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       HARDWARE LINEUP
  ════════════════════════════════════════════════════════════ -->
  <section class="py-24 lg:py-36 section-divider relative overflow-hidden" aria-labelledby="lineup-h">

    <!-- Ambient glow behind the whole section -->
    <div
      aria-hidden="true"
      style="position:absolute; pointer-events:none; top:-10%; left:50%; transform:translateX(-50%); width:clamp(800px,120vw,1400px); height:700px; background:radial-gradient(ellipse at 50% 30%, rgba(79,142,247,0.038) 0%, transparent 58%); filter:blur(90px);"
    ></div>

    <div class="container-wide relative">

      <!-- Section header -->
      <Reveal class="flex items-end justify-between mb-14 lg:mb-18 gap-4">
        <div>
          <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
            Hardware
          </p>
          <h2 id="lineup-h" class="text-display-sm text-[var(--color-ink-1)]">
            Die Geräte.
          </h2>
        </div>
        <a href="/lineup" class="btn-secondary hidden sm:inline-flex flex-shrink-0">
          Alle ansehen
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
            <path d="M2 6.5h9M7 2l4.5 4.5L7 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </Reveal>

      <!-- Cards -->
      <div class="lc-grid">
        {lineup.map((device, idx) => {
          const accent = getAccent(device.data.type);
          return (
            <Reveal delay={idx * 55} class="h-full">
              <a
                href={`/device/${device.slug}`}
                class="lc-card group"
                aria-label={`${device.data.name} — ${device.data.role}`}
              >
                <!-- Visual panel -->
                <div
                  class="lc-panel"
                  style={`background: radial-gradient(ellipse 120% 130% at 50% 80%, ${accent.bg} 0%, transparent 62%), linear-gradient(175deg, var(--color-surface-2) 0%, var(--color-surface-3) 100%);`}
                >
                  <!-- Centered soft bloom -->
                  <div
                    class="lc-bloom"
                    style={`background: radial-gradient(ellipse 58% 58% at 50% 58%, ${accent.bloom} 0%, transparent 65%);`}
                  ></div>

                  <!-- Line-art icon — larger, floats in gradient field -->
                  <div class="lc-icon" style={`color: ${accent.icon};`}>
                    <DevicePlaceholder type={device.data.type} size={56} />
                  </div>
                </div>

                <!-- Content -->
                <div class="lc-body">
                  <div class="lc-text">
                    <p class="lc-name">{device.data.name}</p>
                    <p class="lc-role">{device.data.role}</p>
                  </div>

                  <div class="lc-foot">
                    <!-- Minimal status indicator -->
                    <div class="lc-status" aria-label={`Status: ${statusLabels[device.data.status] ?? device.data.status}`}>
                      <span class={`lc-status-dot lc-status-dot--${device.data.status}`} aria-hidden="true"></span>
                      <span class="lc-status-label">{statusLabels[device.data.status] ?? device.data.status}</span>
                    </div>

                    <span class="lc-cta" aria-hidden="true">Ansehen →</span>
                  </div>
                </div>
              </a>
            </Reveal>
          );
        })}
      </div>

      <!-- Mobile CTA -->
      <Reveal class="mt-8 sm:hidden text-center">
        <a href="/lineup" class="btn-secondary w-full justify-center">Alle Geräte ansehen</a>
      </Reveal>

    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       PHILOSOPHY
  ════════════════════════════════════════════════════════════ -->
  <section class="py-32 lg:py-48 section-divider text-center relative overflow-hidden" aria-labelledby="phil-h">
    <div
      aria-hidden="true"
      class="absolute inset-0 pointer-events-none"
      style="background:rgba(2,4,11,0.32);"
    ></div>
    <div
      aria-hidden="true"
      class="absolute inset-0 pointer-events-none"
      style="background:radial-gradient(ellipse 50% 60% at 50% 50%, rgba(79,142,247,0.07) 0%, transparent 65%);"
    ></div>
    <div class="container-content relative z-10">
      <Reveal>
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-5 sm:mb-6">
          Philosophie
        </p>
        <h2 id="phil-h" class="text-display-lg text-[var(--color-ink-1)] mb-6 sm:mb-8 leading-[0.93]">
          Alles läuft<br/>lokal.
        </h2>
        <p class="text-[1rem] sm:text-[1.05rem] font-light text-[var(--color-ink-3)] max-w-[34ch] mx-auto leading-[1.72]">
          Kein Cloud-Anbieter-Lock-in. Keine Abonnements.
          Volle Kontrolle über Daten, Verfügbarkeit und Architektur.
          Reproduzierbare Infrastruktur — geplant, nicht improvisiert.
        </p>
      </Reveal>
    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       DOCUMENTATION TEASER
  ════════════════════════════════════════════════════════════ -->
  <section class="py-20 lg:py-32 section-divider" aria-labelledby="docs-h">
    <div class="container-content">

      <Reveal class="mb-10 sm:mb-12">
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
          Dokumentation
        </p>
        <h2 id="docs-h" class="text-display-sm text-[var(--color-ink-1)] mb-4 sm:mb-5">
          Dokumentiert wie ein Produkt.
        </h2>
        <p class="text-[0.9375rem] sm:text-[1rem] text-[var(--color-ink-3)] leading-[1.7] max-w-[44ch]">
          Jedes Gerät hat seine eigene Detailseite.
          Nicht nur Spezifikationen — die Geschichte hinter jeder Entscheidung.
        </p>
      </Reveal>

      <Reveal delay={80}>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 mb-10 sm:mb-12">
          {docItems.map(item => (
            <div class="flex items-center gap-3 px-4 py-3 sm:py-3.5 rounded-[10px] border border-[rgba(255,255,255,0.055)] bg-[var(--color-surface-1)]">
              <div
                aria-hidden="true"
                class="w-1.5 h-1.5 rounded-full flex-shrink-0"
                style="background:var(--color-accent); opacity:0.75;"
              ></div>
              <p class="text-[0.84rem] sm:text-[0.875rem] text-[var(--color-ink-2)]">{item}</p>
            </div>
          ))}
        </div>
      </Reveal>

      <Reveal delay={120} class="text-center">
        <a href="/lineup" class="btn-primary">
          Alle Geräte ansehen
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
            <path d="M2 6.5h9M7 2l4.5 4.5L7 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </Reveal>

    </div>
  </section>

</Layout>

<style>
  /* ── Grid ──────────────────────────────────────────────────── */
  .lc-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.125rem;
  }
  @media (min-width: 768px) {
    .lc-grid { grid-template-columns: repeat(3, 1fr); gap: 1.375rem; }
  }

  /* ── Card ──────────────────────────────────────────────────── */
  .lc-card {
    display: flex;
    flex-direction: column;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.055);
    background: var(--color-surface-1);
    overflow: hidden;
    text-decoration: none;
    height: 100%;
    transition:
      transform      320ms cubic-bezier(0.16, 1, 0.3, 1),
      box-shadow     320ms ease,
      border-color   320ms ease;
  }
  .lc-card:hover {
    transform: translateY(-6px);
    border-color: rgba(255, 255, 255, 0.09);
    box-shadow:
      0 28px 56px rgba(0, 0, 0, 0.38),
      0 8px  20px rgba(0, 0, 0, 0.22),
      0 0   0 1px rgba(255, 255, 255, 0.06);
  }
  .lc-card:focus-visible {
    outline: 2px solid rgba(79, 142, 247, 0.6);
    outline-offset: 3px;
  }

  /* ── Visual panel ──────────────────────────────────────────── */
  .lc-panel {
    position: relative;
    height: 148px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex-shrink: 0;
  }
  @media (min-width: 640px)  { .lc-panel { height: 168px; } }
  @media (min-width: 1024px) { .lc-panel { height: 180px; } }

  /* Centered radial bloom (accent-tinted) */
  .lc-bloom {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: opacity 320ms ease;
    opacity: 0.85;
  }
  .lc-card:hover .lc-bloom { opacity: 1; }

  /* Icon wrapper — holds the SVG, tints it via `color` */
  .lc-icon {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 320ms cubic-bezier(0.16, 1, 0.3, 1);
  }
  .lc-card:hover .lc-icon { transform: translateY(-3px) scale(1.04); }

  /* DevicePlaceholder renders with opacity-[0.22]; boost on hover via filter */
  .lc-icon svg {
    filter: drop-shadow(0 0 0px transparent);
    transition: filter 320ms ease, opacity 320ms ease;
    opacity: 0.26;
  }
  .lc-card:hover .lc-icon svg {
    opacity: 0.38;
    filter: drop-shadow(0 2px 12px currentColor);
  }

  /* ── Content body ──────────────────────────────────────────── */
  .lc-body {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
    padding: 1.125rem 1.25rem 1.25rem;
    flex: 1;
  }

  .lc-text { display: flex; flex-direction: column; gap: 0.2rem; flex: 1; }

  .lc-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-ink-1);
    letter-spacing: -0.015em;
    line-height: 1.25;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  @media (min-width: 640px) { .lc-name { font-size: 0.9375rem; } }

  .lc-role {
    font-size: 0.75rem;
    color: var(--color-ink-3);
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ── Footer row ────────────────────────────────────────────── */
  .lc-foot {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
  }

  /* Minimal status badge */
  .lc-status {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .lc-status-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .lc-status-dot--online      { background: rgba(34,  197, 94,  0.60); }
  .lc-status-dot--offline     { background: rgba(239, 68,  68,  0.55); }
  .lc-status-dot--maintenance { background: rgba(245, 158, 11,  0.55); }
  .lc-status-dot--retired     { background: rgba(107, 114, 128, 0.45); }

  .lc-status-label {
    font-size: 0.67rem;
    color: var(--color-ink-4);
    font-weight: 500;
    letter-spacing: 0.01em;
  }

  /* CTA arrow */
  .lc-cta {
    font-size: 0.7rem;
    color: var(--color-ink-4);
    white-space: nowrap;
    transition: color 200ms ease;
    flex-shrink: 0;
  }
  .lc-card:hover .lc-cta { color: var(--color-accent); }

  /* ── Reduced motion ────────────────────────────────────────── */
  @media (prefers-reduced-motion: reduce) {
    .lc-card, .lc-bloom, .lc-icon, .lc-icon svg, .lc-cta { transition: none; }
    .lc-card:hover { transform: none; }
  }
</style>
