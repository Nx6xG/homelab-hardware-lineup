---
import { getCollection } from 'astro:content';
import Layout from '../components/Layout.astro';
import Badge from '../components/Badge.astro';
import Reveal from '../components/Reveal.astro';
import DevicePlaceholder from '../components/DevicePlaceholder.astro';

const devices = await getCollection('devices');
const sorted  = [...devices].sort(
  (a, b) => new Date(b.data.updated).getTime() - new Date(a.data.updated).getTime()
);

const lineup = sorted.slice(0, 6);

// Per device-type: gradient bg + geometric dot color + dot border-radius
const getAccent = (type: string) => {
  const map: Record<string, { bg: string; dot: string; r: string }> = {
    'raspberry-pi': { bg: 'rgba(79,142,247,0.09)',  dot: 'rgba(79,142,247,0.38)',  r: '50%' },
    'nas':          { bg: 'rgba(245,158,11,0.08)',  dot: 'rgba(245,158,11,0.32)',  r: '5px' },
    'server':       { bg: 'rgba(99,102,241,0.09)',  dot: 'rgba(99,102,241,0.38)',  r: '4px' },
    'pc':           { bg: 'rgba(99,102,241,0.08)',  dot: 'rgba(99,102,241,0.32)',  r: '4px' },
    'network':      { bg: 'rgba(34,197,94,0.08)',   dot: 'rgba(34,197,94,0.32)',   r: '50%' },
    'console':      { bg: 'rgba(236,72,153,0.07)',  dot: 'rgba(236,72,153,0.28)',  r: '7px' },
    'smart-home':   { bg: 'rgba(168,85,247,0.08)',  dot: 'rgba(168,85,247,0.32)',  r: '50%' },
    'display':      { bg: 'rgba(148,163,184,0.07)', dot: 'rgba(148,163,184,0.28)', r: '3px' },
  };
  return map[type] ?? { bg: 'rgba(79,142,247,0.07)', dot: 'rgba(79,142,247,0.28)', r: '6px' };
};

// Hero title — word-by-word entrance animation
const heroLines = ['HomeLab.'];

// Stable metrics — no runtime-computed service/uptime counts
const sysMetrics = [
  { value: String(devices.length), label: 'Devices'     },
  { value: '30+',                  label: 'Services'    },
  { value: '100%',                 label: 'Self-hosted' },
  { value: '0€',                   label: 'Cloud cost'  },
];

const docItems = [
  'What runs on it',
  'Architecture overview',
  'Decisions made',
  'Trade-offs & learnings',
  "What I'd improve next",
  'Full specifications',
];
---

<Layout
  title="HomeLab"
  description="Hardware, software, and architecture — a personal homelab documented as a product."
>

  <!-- ═══════════════════════════════════════════════════════
       HERO
  ════════════════════════════════════════════════════════════ -->
  <section
    class="hero-ambient bg-grid relative min-h-screen flex flex-col items-center justify-center pt-24 pb-28 lg:pb-40 overflow-hidden"
    aria-label="Introduction"
  >
    <!-- Soft radial glow behind headline -->
    <div
      aria-hidden="true"
      style="position:absolute; pointer-events:none; top:30%; left:50%; transform:translate(-50%,-50%); width:clamp(500px,110vw,1100px); height:clamp(400px,80vw,800px); background:radial-gradient(ellipse at center, rgba(79,142,247,0.10) 0%, rgba(99,102,241,0.04) 45%, transparent 68%); filter:blur(110px);"
    ></div>
    <!-- Drifting accent orb -->
    <div
      aria-hidden="true"
      class="drift"
      style="position:absolute; pointer-events:none; bottom:20%; right:15%; width:clamp(140px,25vw,300px); height:clamp(100px,18vw,220px); background:radial-gradient(ellipse at center, rgba(99,102,241,0.07) 0%, transparent 65%); filter:blur(55px); animation-delay:-6s; opacity:0.4;"
    ></div>

    <div class="container-content relative z-10 text-center">

      <!-- Eyebrow -->
      <p
        class="text-[0.68rem] font-semibold tracking-[0.26em] uppercase text-[var(--color-ink-4)] mb-10 sm:mb-12"
        style="animation:hero-fade-up 600ms 80ms cubic-bezier(0.16,1,0.3,1) both"
      >
        Personal Homelab
      </p>

      <!-- "HomeLab." — word-by-word entrance animation -->
      <h1 class="mb-8 sm:mb-12" aria-label="HomeLab.">
        {heroLines.map((line, i) => (
          <div
            class="word-in block font-extrabold tracking-[-0.045em] text-[var(--color-ink-1)]"
            style={`font-size:clamp(3.4rem,14vw,11rem); line-height:0.90; animation-delay:${160 + i * 160}ms`}
          >
            {line}
          </div>
        ))}
      </h1>

      <!-- Subhead -->
      <p
        class="text-[clamp(1rem,1.8vw,1.2rem)] font-light text-[var(--color-ink-3)] max-w-[38ch] mx-auto leading-[1.65] mb-10 sm:mb-14"
        style="animation:hero-fade-up 700ms 570ms cubic-bezier(0.16,1,0.3,1) both"
      >
        Hardware, software, and architecture —
        documented like a product.
      </p>

      <!-- CTAs — stacked on mobile, side by side on sm+ -->
      <div
        class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4"
        style="animation:hero-fade-up 700ms 700ms cubic-bezier(0.16,1,0.3,1) both"
      >
        <a href="/lab" class="btn-primary-lg w-full sm:w-auto justify-center">
          Explore the lab
          <svg width="15" height="15" viewBox="0 0 14 14" fill="none" aria-hidden="true">
            <path d="M2 7h10M7 2l5 5-5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <a href="/lineup" class="btn-secondary-lg w-full sm:w-auto justify-center">
          View hardware
        </a>
      </div>

    </div>

    <!-- Fade into next section — taller for more breathing room -->
    <div
      aria-hidden="true"
      class="absolute inset-x-0 bottom-0 h-64 pointer-events-none"
      style="background:linear-gradient(to top, var(--color-surface-0) 0%, rgba(5,7,15,0.85) 40%, transparent 100%);"
    ></div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       SYSTEM OVERVIEW
  ════════════════════════════════════════════════════════════ -->
  <section class="py-20 lg:py-32 section-divider" aria-labelledby="overview-h">
    <div class="container-content">

      <Reveal class="mb-14 sm:mb-16">
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
          Overview
        </p>
        <h2 id="overview-h" class="text-display-sm text-[var(--color-ink-1)]">
          The system, at a glance.
        </h2>
      </Reveal>

      <Reveal delay={80}>
        <div
          class="glass-card-glow rounded-[20px] px-5 sm:px-8 py-7 sm:py-10"
          role="list"
          aria-label="System metrics"
        >
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-6 sm:gap-8">
            {sysMetrics.map(({ value, label }) => (
              <div class="text-center" role="listitem">
                <p class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold text-[var(--color-ink-1)] tabular-nums leading-none mb-1.5">
                  {value}
                </p>
                <p class="text-[0.65rem] font-medium tracking-[0.1em] uppercase text-[var(--color-ink-4)]">
                  {label}
                </p>
              </div>
            ))}
          </div>
        </div>
      </Reveal>

    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       HARDWARE LINEUP TEASER
  ════════════════════════════════════════════════════════════ -->
  <section class="py-20 lg:py-32 section-divider" aria-labelledby="lineup-h">
    <div class="container-wide">

      <Reveal class="flex items-end justify-between mb-12 sm:mb-16 gap-4">
        <div>
          <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
            Hardware
          </p>
          <h2 id="lineup-h" class="text-display-sm text-[var(--color-ink-1)]">
            Hardware
          </h2>
        </div>
        <a href="/lineup" class="btn-secondary hidden sm:inline-flex flex-shrink-0">
          Explore all
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
            <path d="M2 6.5h9M7 2l4.5 4.5L7 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </Reveal>

      <!-- 2-col on mobile → 3-col on sm+ -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 stagger-children">
        {lineup.map(device => {
          const accent = getAccent(device.data.type);
          return (
            <a
              href={`/device/${device.slug}`}
              class="lineup-card group relative block p-4 sm:p-5 rounded-[14px] sm:rounded-[16px] border border-[rgba(255,255,255,0.065)] bg-[var(--color-surface-1)] overflow-hidden"
              aria-label={`${device.data.name} — ${device.data.role}`}
            >
              <!-- Ambient corner accent gradient -->
              <div
                aria-hidden="true"
                style={`position:absolute; top:0; right:0; width:100px; height:100px; background:radial-gradient(ellipse at top right, ${accent.bg}, transparent 70%); pointer-events:none;`}
              ></div>

              <!-- Device type placeholder -->
              <div
                aria-hidden="true"
                class="relative w-full h-20 sm:h-24 rounded-[8px] sm:rounded-[10px] mb-3 sm:mb-4 flex items-center justify-center overflow-hidden"
                style={`background: radial-gradient(ellipse at 50% 40%, ${accent.bg} 0%, transparent 65%), linear-gradient(160deg, var(--color-surface-2) 0%, var(--color-surface-3) 100%); border:1px solid rgba(255,255,255,0.05);`}
              >
                <DevicePlaceholder type={device.data.type} size={28} />
              </div>

              <!-- Name + role -->
              <p class="text-[0.84rem] sm:text-[0.9rem] font-semibold text-[var(--color-ink-1)] mb-0.5 truncate relative z-10 leading-snug">
                {device.data.name}
              </p>
              <p class="text-[0.75rem] sm:text-[0.8rem] text-[var(--color-ink-3)] truncate relative z-10 mb-3 sm:mb-4 leading-snug">
                {device.data.role}
              </p>

              <!-- Status + explore -->
              <div class="flex items-center justify-between relative z-10">
                <Badge status={device.data.status} size="sm" />
                <span class="text-[0.68rem] sm:text-[0.72rem] text-[var(--color-ink-4)] group-hover:text-[var(--color-accent)] transition-colors duration-200">
                  Explore →
                </span>
              </div>
            </a>
          );
        })}
      </div>

      <!-- Mobile-only CTA -->
      <Reveal class="mt-6 sm:hidden text-center">
        <a href="/lineup" class="btn-secondary w-full justify-center">Explore all devices</a>
      </Reveal>

    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       PHILOSOPHY
  ════════════════════════════════════════════════════════════ -->
  <section class="py-32 lg:py-48 section-divider text-center relative overflow-hidden" aria-labelledby="phil-h">
    <!-- Darker overlay for cinematic chapter-break feel -->
    <div
      aria-hidden="true"
      class="absolute inset-0 pointer-events-none"
      style="background:rgba(2,4,11,0.32);"
    ></div>
    <!-- Radial accent glow -->
    <div
      aria-hidden="true"
      class="absolute inset-0 pointer-events-none"
      style="background:radial-gradient(ellipse 50% 60% at 50% 50%, rgba(79,142,247,0.07) 0%, transparent 65%);"
    ></div>
    <div class="container-content relative z-10">
      <Reveal>
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-5 sm:mb-6">
          Philosophy
        </p>
        <h2 id="phil-h" class="text-display-lg text-[var(--color-ink-1)] mb-6 sm:mb-8 leading-[0.93]">
          Everything<br/>runs locally.
        </h2>
        <p class="text-[1rem] sm:text-[1.05rem] font-light text-[var(--color-ink-3)] max-w-[34ch] mx-auto leading-[1.72]">
          No cloud vendor lock-in. No subscriptions.
          Full control over data, uptime, and architecture.
          Reproducible infrastructure — designed, not improvised.
        </p>
      </Reveal>
    </div>
  </section>


  <!-- ═══════════════════════════════════════════════════════
       DOCUMENTATION TEASER
  ════════════════════════════════════════════════════════════ -->
  <section class="py-20 lg:py-32 section-divider" aria-labelledby="docs-h">
    <div class="container-content">

      <Reveal class="mb-10 sm:mb-12">
        <p class="text-[0.68rem] font-semibold tracking-[0.22em] uppercase text-[var(--color-ink-4)] mb-3">
          Documentation
        </p>
        <h2 id="docs-h" class="text-display-sm text-[var(--color-ink-1)] mb-4 sm:mb-5">
          Documented like a product.
        </h2>
        <p class="text-[0.9375rem] sm:text-[1rem] text-[var(--color-ink-3)] leading-[1.7] max-w-[44ch]">
          Each device in the lab has its own deep-dive page.
          Not just specs — the full story behind every decision.
        </p>
      </Reveal>

      <Reveal delay={80}>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 mb-10 sm:mb-12">
          {docItems.map(item => (
            <div class="flex items-center gap-3 px-4 py-3 sm:py-3.5 rounded-[10px] border border-[rgba(255,255,255,0.055)] bg-[var(--color-surface-1)]">
              <div
                aria-hidden="true"
                class="w-1.5 h-1.5 rounded-full flex-shrink-0"
                style="background:var(--color-accent); opacity:0.75;"
              ></div>
              <p class="text-[0.84rem] sm:text-[0.875rem] text-[var(--color-ink-2)]">{item}</p>
            </div>
          ))}
        </div>
      </Reveal>

      <Reveal delay={120} class="text-center">
        <a href="/lineup" class="btn-primary">
          View all devices
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
            <path d="M2 6.5h9M7 2l4.5 4.5L7 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </Reveal>

    </div>
  </section>

</Layout>
